
![moodtown!](frontend/src/assets/icons/moodtown!.svg)

moodtown은 사용자의 일기를 **AI가 분석해 7가지 감정의 주민 캐릭터로 시각화**하고,  
감정 기반의 마을을 **성장·변화·반응**시키는 인터랙티브 감정 다이어리 플랫폼입니다.



### 배포 링크
[☘️ Go to moodtown!](https://moodtown-three.vercel.app/)

### 시연 영상
[![시연 영상 보기](https://img.shields.io/badge/click!-FF0000?style=for-the-badge&logo=youtube&logoColor=white)](https://youtu.be/E_laHcBldvI)

### 테스트 계정
- **ID:** ososo  
- **PW:** moodtown 
 



# 📚 목차
- [1. 프로젝트 소개](#1-프로젝트-소개)
- [2. 주요 기능](#2-주요-기능)
- [3. 시스템 아키텍처](#3-시스템-아키텍처)
- [4. 머신러닝/딥러닝 모델 요약](#4-머신러닝딥러닝-모델-요약)
- [5. 사용 기술 스택](#5-사용-기술-스택)
- [6. 실행 방법](#6-실행-방법)
- [7. 폴더 구조](#7-폴더-구조)
- [8. 핵심 개념](#8-핵심-개념)
- [📝 라이선스](#-라이선스)
- [📚 참고 자료](#-참고-자료)

---

# 1. 프로젝트 소개

moodtown은 **AI 감정 분석 + 감정 의인화 + 게임화(Gamification)**를 결합한 감정 일기 플랫폼입니다.

## 1-1. 프로젝트 개요

moodtown은 단순한 일기 앱을 넘어서, 감정을 시각화하고 게임화 요소를 통해 사용자의 감정 표현과 자기 이해를 돕습니다. 지나치기 쉬운 감정을 돌아보고 나의 마음을 알아갈 수 있도록 설계되었습니다.

## 1-2. 핵심 가치

- **감정의 시각화**: 추상적인 감정을 구체적인 캐릭터와 게임 요소로 표현
- **게임화를 통한 동기 부여**: 일기 작성이 재미있고 지속 가능하도록 게임 요소 추가
- **AI 기반 정확한 분석**: GPT-4o-mini를 활용한 정확한 감정 분석 및 자연스러운 대화 생성
- **자기 이해 도움**: 감정 패턴 파악 및 유사한 과거 일기 찾기를 통한 자기 탐색

## 1-3. 작동 흐름

일기를 작성하면 자동으로 다음 과정이 진행됩니다:

1. 🤖 **AI 감정 분석 (GPT-4o-mini)**: 일기 텍스트를 분석하여 7가지 감정에 대한 점수 산출
2. 👥 **감정 주민 7명이 대화**: 감정 분석 결과를 바탕으로 GPT가 주민들의 대화 생성
3. 🌳 **행복 나무 성장**: 긍정적인 감정이 쌓이면 나무가 자라나고 열매가 열림
4. 💧 **스트레스 우물 변화**: 부정적인 감정이 쌓이면 우물에 물이 차오름
5. 💌 **감정 편지 생성**: 특별한 상황에 주민이 편지를 보냄
6. ☁️ **마을 하늘 변화**: 가장 높은 감정에 따라 마을 하늘 색이 변화

사용자의 감정 상태가 마을 곳곳에 반영되며, 자기 이해와 감정 탐색을 돕는 **감정 기반 인터랙티브 타운 게임**입니다. 


# 2. 주요 기능

## 기본 화면
<table>
  <tr>
    <td align="center"><img src="screenshots/login.png" width="90%"><br>로그인</td>
    <td align="center"><img src="screenshots/home.png" width="90%"><br>마을 입구</td>
    <td align="center"><img src="screenshots/village.png" width="90%"><br>마을 전체</td>
  </tr>
</table>

---

## 2-1. 무지개 주민

각 감정마다 고유한 캐릭터가 있으며, 각 주민은 고유한 색상, 성격, 말투를 가지고 있습니다.

| 캐릭터 | 감정 | 설명 | 색상 |
|-------|------|------|------|
| 빨강이 | 분노 | 화남, 짜증, 불평불만 | 빨강 |
| 주황이 | 부끄러움 | 수줍음, 자책, 창피함 | 주황 |
| 노랑이 | 기쁨 | 즐거움, 행복, 신남 | 노랑 |
| 초록이 | 사랑 | 따뜻함, 애정, 우정 | 초록 |
| 파랑이 | 슬픔 | 우울, 무기력함, 속상함 | 파랑 |
| 남색이 | 두려움 | 불안함, 걱정, 초조함 | 남색 |
| 보라 | 놀람 | 충격, 신기함, 호기심 | 보라 |

![무지개 주민](screenshots/resident.png)

### 특징
- **고유한 성격**: 각 주민은 일기에 대한 반응도 다릅니다
- **스토리텔링 대화**: GPT-4o-mini가 주민의 말투·성격을 반영해 자연스러운 대화 생성
- **채팅 기능**: 사용자는 자동 생성된 답변을 통해 주민과 채팅하며 대화할 수 있습니다

---

## 2-2. 감정 분석 시스템

moodtown은 하이브리드 감정 분석 시스템을 사용합니다.

### 분석 방식 비교

| 유형 | 역할 | 정확도 | 실제 사용 | 속도 |
|------|------|---------|-----------|------|
| 딥러닝 모델 | 참고용 감정 분류 | 보통 (63.90%) | ❌ | 빠름 |
| GPT-4o-mini | 실제 감정 분석 | 높음 | ✔ | 보통 |

### 주요 기능

1. **7가지 감정 점수 분석**
   - 일기 텍스트를 기반으로 7가지 감정(기쁨, 사랑, 놀람, 두려움, 분노, 부끄러움, 슬픔)에 대한 점수 산출
   - 각 감정은 0~100점으로 표시되며, 여러 감정이 동시에 존재할 수 있음
   - 감정 점수의 총합이 100이 되도록 정규화

2. **문맥 기반 극성 분석**
   - 놀람과 부끄러움은 문맥에 따라 긍정/부정으로 구분됩니다
   - **Rule-based 분석**: 키워드 패턴 매칭
   - **GPT 기반 분석**: 문맥 이해
   - 두 결과를 결합하여 최종 극성 결정
   - 결정된 극성은 행복 나무/스트레스 우물에 반영됨됨
   - 예시:
     - 긍정 놀람: 좋은 소식, 반가운 소식
     - 부정 놀람: 충격, 갑작스러운 악재
     - 긍정 부끄러움: 수줍음, 두근거림
     - 부정 부끄러움: 창피함, 수치심, 자책

3. **딥러닝 모델 (참고용)**
   - KLUE-RoBERTa 기반 Transformers 모델
   - 정확도 63.90% (참고용으로만 제공)
   - 실제 마을 시스템에는 GPT-4o-mini 분석 결과 사용

<p align="center">
<img src="screenshots/ml_analysis.png" width="45%">
<img src="screenshots/gpt_analysis.png" width="45%">
</p>

---

## 2-3. 마을 하늘

마을 분위기 시스템으로, 사용자의 감정 상태가 마을의 하늘 색에 반영됩니다.

### 작동 메커니즘
- 하루 일기에서 **가장 비중이 높은 감정**을 확인
- 해당 감정의 고유 색상으로 하늘 색이 부드럽게 변화
- 감정 변화가 시각적으로 느껴지도록 하는 연출 시스템

### 감정별 색상
- **기쁨(노랑)**: 따뜻한 노란 하늘
- **슬픔(파랑)**: 푸른빛 하늘
- **분노(빨강)**: 붉은 빛 하늘
- **사랑(초록)**: 부드러운 연두색 톤
- **두려움(남색)**: 어두운 남색 톤
- **놀람(보라)**: 보라빛 하늘
- **부끄러움(주황)**: 따뜻한 주황색 톤

### 구현
- `EmotionSky.jsx` 컴포넌트에서 애니메이션 처리
- CSS keyframes 기반의 부드러운 색상 전환
- `transform` 속성 사용으로 성능 최적화

---

## 2-4. 🌳 Happiness Tree (행복 나무)

긍정적인 감정이 쌓일수록 자라는 나무입니다. 긍정적인 감정 표현을 장려하기 위한 보상 시스템입니다.

### 성장 기여 감정
다음 감정들이 행복 나무의 성장에 기여합니다:
- **기쁨**: 즐거움, 행복, 신남
- **사랑**: 애정, 우정, 따뜻함
- **놀람** (긍정적): 기쁜 소식, 반가운 소식 등
- **부끄러움** (긍정적): 설레는 감정, 좋아하는 사람에 대한 부끄러움 등

**보너스 규칙**: 하루에 긍정 감정만 있으면 보너스 성장도 25점이 추가됩니다.

### 성장 단계

| 단계 | 필요 점수 | 설명 |
|------|----------|------|
| 씨앗 | 0 이상 | 초기 상태 |
| 새싹 | 40 이상 | 작은 새싹이 돋아남 |
| 묘목 | 100 이상 | 작은 나무로 성장 |
| 중간 나무 | 220 이상 | 중간 크기 나무 |
| 큰 나무 | 380 이상 | 큰 나무로 성장 |
| 행복 열매 생성 | 600 도달 | 완전히 자라서 열매가 열림 |

### 열매 시스템
- 나무가 완전히 자라면 열매가 열립니다
- 열매가 열리면 "행복 열매" 개수가 증가합니다
- 열매가 열릴 때마다 축하 편지가 전송됩니다
- 열매가 열리면 스트레스 우물의 물이 30점 줄어듭니다
- 열매 생성 후 나무의 상태는 씨앗 상태로 돌아갑니다

![tree](screenshots/tree.png)

---

## 2-5. 💧 Stress Well (스트레스 우물)

부정적인 감정이 쌓일수록 물이 차오르는 우물입니다. 부정적 감정을 쉽게 파악하게 하는 경고/관리 장치입니다.

### 물을 채우는 감정
다음 감정들이 스트레스 우물에 물을 채웁니다:
- **분노**: 화남, 짜증, 불평불만
- **슬픔**: 우울함, 무기력함, 속상함
- **두려움**: 불안함, 걱정, 초조함
- **놀람** (부정적): 충격, 실망, 황당함 등
- **부끄러움** (부정적): 창피함, 수치심, 민망함 등

**보너스 규칙**: 하루에 부정 감정만 있으면 물이 25점 더 차오릅니다.

### 특별 규칙 (물 감소)
- **긍정 감정만 있을 경우**: 물이 30점 줄어듭니다
  - 즉, 순수 긍정 일기를 작성하면 스트레스가 감소합니다
- **행복 열매가 맺힌 경우**: 물이 30점 줄어듭니다

이러한 특별 규칙들은 우물이 너무 자주 차오르지 않도록 하는 완충 역할을 함과 동시에, 긍정적인 감정에 대한 보상을 더욱 강화합니다.

### 넘침 상태
- 물이 100%에 도달하면 "넘침" 상태가 됩니다
- 넘치면 주민들이 위로하는 편지를 자동으로 전송합니다
- 물이 넘친 후 "우물 비우기" 버튼을 누르면 우물이 초기화됩니다

<p align="center">
<img src="screenshots/well.png" width="45%">
<img src="screenshots/well_full.png" width="45%">
</p>

---

## 2-6. 🗣 Emotion Plaza (와글와글 광장)

각각 다른 감정을 나타내는 무지개 주민들이 일기 내용에 대해 대화를 나누는 공간입니다.

### 기본 기능
- **감정 분석 결과 확인**: 일기의 감정 분석 결과를 확인할 수 있습니다
- **주민 대화**: 일기의 내용과 감정 분석 결과를 토대로 주민들이 이야기를 나눕니다
- **채팅 기능**: 사용자는 마을의 주민들과 채팅하며 소통하고 상호작용할 수 있습니다
- **자연스러운 대화**: 대화는 GPT-4o-mini가 생성하며, 각 주민의 고유한 성격과 말투가 반영됩니다

### 대화 생성 메커니즘

#### 참여 규칙
- **주요 감정** (score > 0): 자신의 감정을 주로 표현하며 적극적으로 참여
- **반응 감정** (score = 0): 다른 감정들에게 반응만 (위로, 동조, 반박 등)

대화 생성 시 감정 점수 기반 우선순위를 적용해, 실제 감정 분포와 일관된 스토리텔링을 유지합니다.

#### 대화 생성 과정
1. 감정 분석 결과 확인
2. 주요 감정과 반응 감정 결정
3. GPT-4o-mini가 각 주민의 특성을 반영한 대화 생성
4. 대화를 데이터베이스에 저장

#### 대화 저장
- 하루의 일기에 대한 대화가 한 번 생성되면 저장됩니다
- 일기가 덮어씌워지거나, 삭제 후 재작성되면 대화가 재생성됩니다

![plaza](screenshots/plaza.png)

---

## 2-7. 📬 Emotion Mail (편지 시스템)

마을의 무지개 주민들이 사용자에게 보내는 편지입니다. 사용자에게 위로, 격려, 공감의 메시지를 제공하며 주민과의 소통을 더욱 체감하게 합니다.

### 컨셉 및 목적
- 편지 이벤트를 통해 사용자가 더 일기를 적극적으로 쓰도록 동기를 부여
- 감정 변화에 대한 즉각적 피드백(보상/위로)
- 주민과의 소통을 더욱 체감하게 함

### 편지 종류

| 편지 종류 | 조건 | 보낸 주민 | 설명 |
|----------|------|-----------|------|
| 감정 편지 | 특정 감정 ≥ 70% | 해당 감정 주민 | 특정 감정이 매우 강할 때 해당 주민이 편지 전송 |
| 축하 편지 | 열매 생성 | 기쁨·사랑 계열 주민 | 행복 나무에 열매가 맺히면 축하 편지 전송 |
| 위로 편지 | 우물 넘침 | 슬픔·두려움·분노 계열 주민 | 스트레스 우물이 넘치면 위로 편지 전송 |

### 편지 생성
- 편지 내용은 GPT-4o-mini가 생성합니다
- 각 주민의 성격과 말투가 반영됩니다
- 위로 편지의 경우, 단순히 우물 넘침 이벤트만 발생하면 간혹 부정적인 감정에 대한 패널티처럼 보일 수 있으므로 이를 방지하기 위해 사용자에게 위로와 격려의 메시지를 제공합니다

![letter](screenshots/letter.png)

---

## 2-8. 📝 일기 작성

일기 작성 및 관리 기능입니다.

### 기본 기능
- **날짜별 일기 작성 및 관리**: 특정 날짜에 일기 작성, 수정, 삭제 가능
  - 원하는 날짜를 선택해서 일기를 작성할 수 있습니다
  - 과거 날짜에도 일기를 작성할 수 있습니다
- **감정 분석**: 딥러닝 모델 또는 GPT-4o-mini를 이용한 감정 분석
  - 일기 작성 시 자동으로 감정 분석이 진행됩니다
  - 딥러닝 모델 분석 결과는 참고용으로 제공됩니다
  - GPT-4o-mini 분석 결과가 실제 마을 시스템에 반영됩니다

### 일기 수정 및 삭제
- 일기를 수정하면 감정 분석이 다시 진행되며, 그에 따라 마을 상태도 함께 변합니다
- 일기를 삭제하면 해당 날짜의 감정 점수가 마을 시스템에서 제거됩니다
- 일기 수정 시 와글와글 광장의 대화가 자동으로 재생성됩니다

![일기 쓰기](screenshots/writediary.png)

---

## 2-9. 🏠 Town Office (마을 사무소)

일기 아카이브, 다양한 통계, 감정 캘린더, 유사한 일기 찾기 등의 기능을 제공합니다.

### 주요 기능

#### 감정 캘린더
- 날짜를 선택하면 해당 날짜의 일기와 감정 분석 결과 확인 가능
- 하루에 가장 비중이 많은 감정 주민의 색을 캘린더에 표시하여 날짜별 주요 감정 시각화
- 한눈에 감정 패턴을 확인할 수 있습니다

#### 이번 달 감정 통계
- 한 달간의 감정 비율을 도넛 그래프로 나타냅니다
- 감정별 비중을 한눈에 파악할 수 있습니다

#### 주간 긍정/부정 추이
- 일주일간의 긍정/부정 지수를 선 그래프로 나타냅니다
- 감정 기복을 파악할 수 있습니다

#### 감정별 평균 점수
- 각 감정의 평균 점수를 표시합니다
- 어떤 감정이 가장 많이 나타나는지 확인할 수 있습니다

#### 요일별 작성 패턴
- 요일별 일기 작성 빈도를 분석하여 언제 일기를 가장 많이 쓰는지 파악할 수 있습니다

#### 연속 일기 작성 / 일기 작성 활동도
- 일기 쓰기 빈도 현황을 통계로 제공합니다
- 한 달동안/일주일동안 일기를 며칠 작성했는지 계산
- 끊기지 않고 연속으로 며칠째 일기를 쓰고 있는지 계산
- 동기 부여에 도움이 됩니다

#### 유사한 일기 찾기
- **Sentence Transformer 모델 기반**으로 선택한 일기와 유사한 감정/내용의 과거 일기 검색
- **텍스트 유사도**: 텍스트가 가장 유사한 일기 1개 제공
- **감정 유사도**: 감정 비율이 가장 유사한 일기 1개 제공
- 두 가지 기준을 독립적으로 제공하여 다양한 관점에서 유사 일기 탐색 가능
- 비슷한 상황에서의 감정 변화 추이 확인 가능
- 자기 이해와 감정 패턴 파악에 도움

**참고**: 마을 사무소는 무조건 서비스 사용 당시 날짜(오늘)을 기준으로 통계를 제공합니다. 사용자는 과거의 날짜를 자유롭게 선택하여 일기를 작성할 수 있고, 이로 인한 통계 표시 혼란을 방지하기 위함입니다.

![office1](screenshots/office1.png)
![office2](screenshots/office2.png)

---

# 3. 시스템 아키텍처

## 📌 시스템 구조 다이어그램
![architecture](docs/architecture.svg)

## 📌 데이터 플로우
![data-flow](docs/data-flow.svg)

---

## 📌 일기 저장 플로우

```
사용자 작성 → 프론트엔드 → 백엔드 API
                      ↓
              GPT-4o-mini 감정 분석
                      ↓
              감정 점수 + 극성(polarity) 산출
                      ↓
              PostgreSQL 저장
                      ↓
              나무/우물 상태 업데이트
                      ↓
              대화 생성 (GPT)
                      ↓
              대화 저장 (DB)
                      ↓
              편지 생성 (필요시)
                      ↓
              응답 반환
```

## 📌 감정 분석 프로세스

### ① 텍스트 전처리
일기 텍스트를 정제하여 분석 준비

### ② GPT-4o-mini 분석
- 시스템 프롬프트로 7가지 감정 점수 요청
- 각 감정에 대한 0~100점 점수 반환
- 놀람/부끄러움의 경우 문맥 기반 극성 분석 요청

### ③ 하이브리드 극성 판단
놀람/부끄러움은 부정적일 수도, 긍정적일 수도 있음:
- **긍정 놀람**: 좋은 소식, 반가운 소식
- **부정 놀람**: 충격, 갑작스러운 악재
- **긍정 부끄러움**: 수줍음, 두근거림
- **부정 부끄러움**: 창피함, 수치심, 자책

**분석 방법**:
- **Rule-based**: 키워드 패턴 매칭
- **GPT 기반**: 문맥 이해
- 두 결과를 결합하여 최종 놀람과 부끄러움의 극성 결정
- 스트레스 우물/행복 나무 반영에 사용됨

### ④ 점수 정규화
7가지 감정 점수의 총합이 100이 되도록 정규화

### ⑤ 결과 반환
JSON 형식으로 감정 점수 및 극성 반환

## 📌 대화 생성 프로세스

### ① 감정 점수 분석
0점 초과 감정 확인

### ② 주민 선정
- **주요 감정** (score > 0): 자신의 감정을 주로 표현
- **반응 감정** (score = 0): 다른 감정들에게 반응만

### ③ GPT 프롬프트 구성
- 일기 내용
- 주민의 성격, 말투
- 역할 규칙 (주요 감정 vs 반응 감정)

### ④ 대화 생성
GPT가 각 주민의 특성을 반영한 자연스러운 대화 생성

### ⑤ DB 저장
생성된 대화를 JSONB 형식으로 `plaza_conversations` 테이블에 저장

---

# 4. 머신러닝/딥러닝 모델 요약

moodtown은 두 가지 모델을 사용합니다.

## 4-1. 감정 분석 딥러닝 모델 (참고용)

일기의 감정을 분류하는 **Transformers 기반 딥러닝 모델**입니다.  
딥러닝 모델의 분석 결과는 정확하지 않으므로 **참고용**으로 제공되며, 실제 마을 시스템에는 GPT-4o-mini의 분석 결과가 사용됩니다.

### 모델 구조

- **기반 모델**: KLUE-RoBERTa-base
- **모델 타입**: RobertaForSequenceClassification
- **감정 라벨**: 5개 (기쁨, 당황, 분노, 불안, 슬픔)
- **입력 최대 길이**: 128 토큰

### 데이터셋

- **출처**: 과학기술정보통신부와 한국지능정보사회진흥원이 운영하는 국가 AI 개발 지원 플랫폼 [AI hub](https://aihub.or.kr/)
- **데이터셋**: [감성 대화 말뭉치 데이터셋](https://aihub.or.kr/aihubdata/data/view.do?dataSetSn=86)
- **파일**: `감성대화말뭉치(최종데이터)_Training.json`
- **사용 데이터**: HS01 발화만 사용 (총 51,628개 샘플)
- **데이터 분포**:
  - 당황: 17,898개
  - 불안: 9,319개
  - 분노: 9,160개
  - 슬픔: 9,125개
  - 기쁨: 6,126개

### 감정 라벨 매핑

AI Hub 데이터셋의 감정 ID를 5개 감정으로 매핑:
- **E10~E19** → 분노
- **E20~E29** → 슬픔
- **E30~E39** → 불안
- **E40~E59** → 당황 (상처 E40~E49 + 당황 E50~E59 통합)
- **E60~E69** → 기쁨

### 학습 설정

- **학습/검증 분할**: 90% / 10% (stratified split)
- **배치 크기**: 32 (gradient accumulation 2로 효과적 배치 크기 64)
- **학습률**: 2e-5
- **옵티마이저**: AdamW
- **스케줄러**: Cosine Annealing with Warmup (warmup 10%)
- **에폭**: 2
- **라벨 스무딩**: 0.1
- **Mixed Precision**: FP16 (AMP 사용)
- **최대 시퀀스 길이**: 128

### 학습 결과

- **검증 정확도 (Validation Accuracy)**: **63.90%**
- **검증 손실 (Validation Loss)**: 1.0781

### 라벨 매핑 (모델 → 서비스)

Transformers 모델의 5개 라벨을 프로젝트의 7가지 감정 시스템으로 매핑:

- **"기쁨"** → "기쁨" (직접 매칭)
- **"분노"** → "분노" (직접 매칭)
- **"슬픔"** → "슬픔" (직접 매칭)
- **"불안"** → "두려움" (100% 그대로 사용)
- **"당황"** → "놀람" + "부끄러움" (키워드 기반 분산)
  - 놀람 키워드가 많으면 → 놀람에 더 많이 할당
  - 부끄러움 키워드가 많으면 → 부끄러움에 더 많이 할당
  - 키워드가 없으면 → 놀람 70%, 부끄러움 30% (기본값)
- **"사랑"** → "기쁨" 점수가 있을 때, 사랑 관련 키워드가 감지되면 "기쁨" 점수의 30%를 "사랑"으로 재분배

### Fallback

Transformers 모델이 로드되지 않거나 예측에 실패할 경우, 키워드 기반 휴리스틱 예측으로 fallback됩니다.

---

## 4-2. 유사 일기 검색 모델 (실제 사용)

일기 간 유사도를 계산하여 비슷한 감정이나 내용의 일기를 찾아주는 **Sentence Transformer** 기반 문서 임베딩 모델입니다.  
이 모델은 **실제 기능**으로 사용되며, 마을 사무소의 "비슷한 일기 찾기" 기능에서 활용됩니다.

### 모델 구조

- **기반 모델**: `jhgan/ko-sentence-transformer-multilingual`
- **모델 타입**: Sentence Transformer (사전 학습된 모델)
- **특징**: 학습 불필요, 한국어 특화, 문맥 기반 의미 이해

### 알고리즘: Sentence Transformer

- **Sentence Transformer**: 문장 전체를 의미 기반 벡터로 변환하는 딥러닝 모델
- 각 문서(일기)를 고정된 크기의 벡터로 변환하여 유사한 문서들을 찾을 수 있음
- 문맥을 고려한 의미적 유사도 계산
- 한국어에 최적화된 다국어 모델 사용

### 유사도 계산 방법

#### 1. 텍스트 유사도 (Sentence Transformer)
- 일기 텍스트를 Sentence Transformer 모델로 벡터화
- 코사인 유사도(Cosine Similarity)로 두 일기의 텍스트 유사도 계산
- 문맥과 의미를 고려한 정확한 유사도 측정

#### 2. 감정 점수 유사도
- 두 일기의 감정 점수 분포를 비교
- 7개 감정(기쁨, 사랑, 놀람, 두려움, 분노, 부끄러움, 슬픔)을 벡터로 변환
- 코사인 유사도로 감정 비율 유사도 계산

#### 3. 분리된 결과 제공
- **텍스트 유사도**: 텍스트가 가장 유사한 일기 1개 반환
- **감정 유사도**: 감정 비율이 가장 유사한 일기 1개 반환
- 두 가지 기준을 독립적으로 제공하여 다양한 관점에서 유사 일기 탐색 가능

### 활용 사례
- **마을 사무소**: 특정 일기와 유사한 과거 일기들을 찾아 감정 패턴 파악
- **자기 이해**: 비슷한 상황에서의 감정 변화 추이 확인
- **통계 분석**: 유사한 감정을 보이는 일기들의 통계 제공


---

# 5. 사용 기술 스택

## 5-1. Frontend

### React 19.2.0
- **역할**: 사용자 인터페이스 구축을 위한 JavaScript 라이브러리
- **주요 기능**: 
  - 함수형 컴포넌트와 Hooks (`useState`, `useEffect`) 사용
  - 페이지별 컴포넌트 분리 (Home, Village, WriteDiary, Plaza, Tree, Well, Office, Mailbox)
  - 데이터 캐싱 전략으로 성능 최적화

### Vite (Rolldown 기반) 7.2.2
- **역할**: 프론트엔드 빌드 도구 및 개발 서버
- **사용 이유**:
  - 빠른 Hot Module Replacement (HMR)로 개발 경험 향상
  - Rolldown 기반으로 Rust로 작성된 빠른 번들러
  - 프로덕션 빌드 최적화

### CSS3
- **역할**: 커스텀 스타일링 및 애니메이션
- **주요 기능**:
  - Flexbox/Grid 레이아웃
  - CSS 애니메이션 (플로팅 주민, 배경 효과)
  - 반응형 디자인 (미디어 쿼리)
  - 커스텀 폰트 (Dongle Font)

## 5-2. Backend

### Flask 3.1.2
- **역할**: Python 기반 웹 프레임워크(RESTful API 서버)
- **사용 이유**:
  - 경량화되고 유연한 구조
  - RESTful API 구축에 적합
  - Python 생태계와의 호환성

### PostgreSQL
- **역할**: 관계형 데이터베이스 관리 시스템
- **사용 이유**:
  - JSONB 타입으로 유연한 데이터 저장 (감정 점수, 대화 등)
  - ACID 트랜잭션 보장
  - 확장성과 안정성
- **주요 테이블**:
  - `users`: 사용자 정보
  - `diaries`: 일기 데이터 (제목, 내용, 날짜, 감정 점수)
  - `tree_state`: 행복 나무 상태 (성장 단계, 열매 수)
  - `well_state`: 스트레스 우물 상태 (물 높이)
  - `letters`: 감정 주민들이 보내는 편지
  - `plaza_conversations`: 와글와글 광장 대화 (JSONB)

### OpenAI API (GPT-4o-mini)
- **역할**: 감정 분석, 대화 생성, 편지 생성
- **주요 사용처**:
  1. **감정 분석** (`emotion_gpt.py`): 일기 텍스트를 분석하여 7가지 감정 점수 제공
  2. **대화 생성** (`conversation.py`): 감정 주민들이 일기에 대해 대화하는 내용 생성
  3. **편지 생성** (`letter_generator.py`): 감정 주민이 보내는 편지 생성

### 주요 라이브러리
- **flask-cors 6.0.1**: CORS 처리
- **psycopg2-binary 2.9.9+**: PostgreSQL 연결
- **gunicorn 21.2.0+**: 프로덕션 WSGI 서버
- **python-dotenv 1.2.1**: 환경변수 관리
- **openai 1.0.0+**: OpenAI API 클라이언트

## 5-3. Machine Learning / Deep Learning

### transformers 4.39.3+
- **용도**: KLUE-RoBERTa 기반 감정 분류 딥러닝 모델
- **알고리즘**: Transformers (RobertaForSequenceClassification)
- **모델 타입**: 딥러닝 (Deep Learning)

### sentence-transformers 2.2.0+
- **용도**: Sentence Transformer 기반 유사 일기 검색 모델
- **알고리즘**: Sentence Transformer (사전 학습된 딥러닝 모델)
- **모델**: jhgan/ko-sentence-transformer-multilingual
- **모델 타입**: 딥러닝 (Deep Learning)

### 기타 ML 라이브러리
- **joblib 1.3.0+**: ML 모델 저장/로딩
- **matplotlib 3.8.0+**: 데이터 시각화 (학습 스크립트용)
- **seaborn 0.13.0+**: 통계 데이터 시각화 (학습 스크립트용)

## 5-4. 배포 플랫폼

- **Vercel**: 프론트엔드 배포
- **Railway**: 백엔드 및 PostgreSQL 호스팅  

---

# 6. 실행 방법

## 사전 요구사항
- Python 3.8 이상
- Node.js 18 이상
- PostgreSQL 데이터베이스
- OpenAI API 키

## Backend 설정

### 1. 가상환경 생성 및 활성화
```bash
cd backend
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

### 2. 의존성 설치
```bash
pip install -r requirements.txt
```

### 3. 환경 변수 설정
`.env` 파일을 `backend/` 폴더에 생성하고 다음 내용을 입력하세요:

```env
# 데이터베이스
DATABASE_URL=postgresql://user:password@host:port/database

# OpenAI API
OPENAI_API_KEY=your-openai-api-key

# 세션 시크릿
SECRET_KEY=your-secret-key

# 프론트엔드 URL (개발 환경)
FRONTEND_URL=http://localhost:5173

# 환경 설정
ENVIRONMENT=development
```

### 4. 데이터베이스 초기화
```bash
python -c "from db import init_db; init_db()"
```

### 5. 서버 실행
```bash
python app.py
```

개발 서버는 기본적으로 `http://localhost:5000`에서 실행됩니다.

## Frontend 설정

### 1. 의존성 설치
```bash
cd frontend
npm install
```

### 2. 개발 서버 실행
```bash
npm run dev
```

개발 서버는 기본적으로 `http://localhost:5173`에서 실행됩니다.

### 3. 프로덕션 빌드
```bash
npm run build
```

빌드된 파일은 `dist/` 폴더에 생성됩니다.

# 7. 폴더 구조

```
moodtown/
├── backend/                           # Flask 백엔드
│   ├── api/                           # API 라우트
│   │   ├── __init__.py
│   │   ├── auth.py                    # 인증 관련 API
│   │   ├── chat.py                    # 채팅/대화 API
│   │   ├── diary.py                   # 일기 관련 API
│   │   ├── letters.py                 # 편지 관련 API
│   │   ├── middleware.py              # 미들웨어
│   │   ├── routes.py                  # 라우트 설정
│   │   ├── tree.py                    # 행복 나무 API
│   │   └── well.py                    # 스트레스 우물 API
│   ├── services/                      # 비즈니스 로직
│   │   ├── __init__.py
│   │   ├── conversation.py            # 대화 생성 서비스
│   │   ├── diary_similarity.py        # 유사 일기 검색 서비스
│   │   ├── emotion_gpt.py             # GPT 기반 감정 분석
│   │   ├── emotion_ml.py              # ML 기반 감정 분석
│   │   ├── letter_generator.py        # 편지 생성 서비스
│   │   ├── models/                    # 학습된 딥러닝/머신러닝 모델
│   │   │   ├── moodtown_emotion_model/  # Transformers 감정 분석 모델
│   │   │   └── (Sentence Transformer 모델은 사전 학습된 모델을 사용하므로 별도 모델 파일 없음)
│   │   ├── train_diary_similarity.py  # (사용 안 함, Sentence Transformer는 학습 불필요)
│   │   └── train_emotion.ipynb        # 감정 분석 모델 학습 스크립트 (Jupyter Notebook)
│   ├── core/                          # 공통 모듈
│   │   ├── __init__.py
│   │   └── common.py                  # 공통 유틸리티
│   ├── app.py                         # Flask 애플리케이션 진입점
│   ├── characters.json                # 감정 주민 캐릭터 설정
│   ├── db.py                          # 데이터베이스 연결 및 초기화
│   ├── Procfile                       # Railway 배포 설정
│   ├── pyrightconfig.json            # Python 타입 체크 설정
│   ├── railway.json                   # Railway 배포 설정
│   ├── requirements.txt               # Python 의존성
│   └── runtime.txt                    # Python 런타임 버전
├── frontend/                          # React 프론트엔드
│   ├── public/                        # 정적 파일
│   ├── src/
│   │   ├── assets/                    # 이미지 및 아이콘
│   │   │   ├── characters/            # 감정 주민 캐릭터 이미지
│   │   │   └── icons/                 # 아이콘
│   │   ├── components/                # 재사용 컴포넌트
│   │   │   ├── EmotionSky.css
│   │   │   ├── EmotionSky.jsx
│   │   │   ├── FloatingResidents.css
│   │   │   ├── FloatingResidents.jsx
│   │   │   ├── ResidentsIntro.css
│   │   │   └── ResidentsIntro.jsx
│   │   ├── pages/                     # 페이지 컴포넌트
│   │   │   ├── Guide.css / Guide.jsx
│   │   │   ├── Home.css / Home.jsx
│   │   │   ├── Login.css / Login.jsx
│   │   │   ├── Mailbox.css / Mailbox.jsx
│   │   │   ├── Office.css / Office.jsx
│   │   │   ├── Plaza.css / Plaza.jsx
│   │   │   ├── Tree.css / Tree.jsx
│   │   │   ├── Village.css / Village.jsx
│   │   │   ├── Well.css / Well.jsx
│   │   │   └── WriteDiary.css / WriteDiary.jsx
│   │   ├── style/                     # 전역 스타일
│   │   │   └── globals.css
│   │   ├── utils/                     # 유틸리티 함수
│   │   │   ├── api.js                 # API 호출 함수
│   │   │   ├── dateUtils.js           # 날짜 유틸리티
│   │   │   ├── diaryCache.js          # 일기 캐시 관리
│   │   │   ├── emotionColorMap.js     # 감정 색상 매핑
│   │   │   ├── emotionUtils.js        # 감정 관련 유틸리티
│   │   │   ├── mailboxUtils.js        # 편지함 유틸리티
│   │   │   ├── storage.js             # 로컬 스토리지 관리
│   │   │   ├── treeUtils.js           # 행복 나무 유틸리티
│   │   │   └── wellUtils.js           # 스트레스 우물 유틸리티
│   │   ├── App.css
│   │   ├── App.jsx                    # 메인 앱 컴포넌트
│   │   ├── index.css
│   │   └── main.jsx                   # React 진입점
│   ├── eslint.config.js               # ESLint 설정
│   ├── index.html                     # HTML 템플릿
│   ├── package.json                   # Node.js 의존성
│   ├── vercel.json                    # Vercel 배포 설정
│   └── vite.config.js                 # Vite 빌드 설정
├── docs/                              # 문서
│   ├── ARCHITECTURE.md                # 시스템 아키텍처
│   ├── BACKEND.md                     # 백엔드 가이드
│   ├── FEATURES.md                    # 주요 기능 설명
│   ├── FRONTEND.md                    # 프론트엔드 가이드
│   └── ML_MODELS.md                   # 딥러닝/머신러닝 모델 설명
├── screenshots/                       # 스크린샷 이미지
├── LICENSE                            # MIT 라이선스
└── README.md                          # 프로젝트 README
```

# 8. 핵심 개념

## 8-1. 감정의 시각화와 의인화를 통한 커뮤니케이션

### 컨셉
추상적인 감정을 구체적인 캐릭터와 게임 요소로 표현합니다. 7가지 감정(기쁨, 사랑, 놀람, 두려움, 분노, 부끄러움, 슬픔)은 각각 고유한 색상과 성격을 가진 주민 캐릭터로 나타납니다.

### 효과
- 감정의 의인화를 통해 자신의 감정에 더욱 친근하게 다가갈 수 있도록 합니다
- 감정을 외부화하여 객관적으로 바라볼 수 있게 합니다
- 감정 주민과의 대화를 통해 감정에 대한 다양한 관점을 제공합니다

## 8-2. 게임화(Gamification)

일기 작성이 재미있고 지속 가능하도록 게임 요소를 추가했습니다.

### 게임 요소
- **행복 나무**: 긍정적인 감정이 쌓이면 나무가 자라나고 열매를 맺음
- **스트레스 우물**: 부정적인 감정이 쌓이면 우물에 물이 차오름
- **감정 주민 대화**: 주민들이 일기에 대해 대화를 나눔
- **편지 시스템**: 특별한 상황에 주민이 편지를 보냄
- **마을 하늘 변화**: 감정에 따라 마을 하늘 색이 변화

### 동기 부여
- 성취감 제공 (행복 열매 수집)
- 즉각적인 피드백 (감정 변화가 마을에 반영)
- 지속적인 상호작용 (주민과의 대화, 편지)

## 8-3. AI 기반 분석

GPT-4o-mini와 딥러닝 모델을 활용한 정확한 감정 분석 시스템입니다.

### 하이브리드 감정 분석
- **GPT-4o-mini**: 최종 감정 분석 및 대화 생성 (실제 사용)
  - 높은 정확도
  - 문맥 이해 능력
  - 자연스러운 대화 생성
- **딥러닝 모델 (Transformers)**: 참고용 감정 분석 제공
  - KLUE-RoBERTa 기반 Transformers 모델
  - 빠른 분석 속도
  - 정확도 63.90%
  - 비교용으로 제공

### 주요 활용
- **감정 분석**: 일기 텍스트를 분석하여 7가지 감정 점수 제공
- **대화 생성**: 감정 주민들의 자연스러운 대화 생성
- **편지 생성**: 상황에 맞는 편지 내용 생성

## 8-4. 문맥 기반 감정 분류

"놀람"과 "부끄러움"은 문맥에 따라 긍정/부정으로 구분됩니다.

## 8-5. 실시간 대화 생성

GPT를 활용한 자연스러운 캐릭터 대화 시스템입니다.

### 특징
- **각 주민의 고유한 성격과 말투 반영**: GPT가 주민의 특성을 학습하여 자연스러운 대화 생성
- **감정 점수 기반 참여 규칙**: 
  - 주요 감정(score > 0): 자신의 감정을 주로 표현
  - 반응 감정(score = 0): 다른 감정들에게 반응만
- **일기 내용에 대한 다양한 관점 제공**: 각 주민이 다른 관점에서 일기를 해석

### 생성 과정
1. 감정 점수 확인
2. 주요/반응 감정 분류
3. 주민 성격·말투 기반 프롬프트 구성
4. GPT-4o-mini로 대화 생성
5. DB 저장

## 8-6. 유사 일기 검색

Sentence Transformer 기반으로 과거 유사한 감정/내용의 일기를 찾는 기능입니다.

### 유사도 계산 방법
- **텍스트 유사도**: Sentence Transformer 모델로 문서 벡터화 후 코사인 유사도 계산
  - 문맥과 의미를 고려한 정확한 유사도 측정
  - 텍스트가 가장 유사한 일기 1개 반환
- **감정 유사도**: 저장된 감정 점수 분포를 기반으로 코사인 유사도 계산
  - 7개 감정(기쁨, 사랑, 놀람, 두려움, 분노, 부끄러움, 슬픔)을 벡터로 변환
  - 감정 비율이 가장 유사한 일기 1개 반환

### 결과 제공
- 텍스트 유사도와 감정 유사도를 **독립적으로** 각각 1개씩 제공
- 두 가지 기준을 통해 다양한 관점에서 유사 일기 탐색 가능

### 활용
- **자기 이해**: 비슷한 상황에서의 감정 변화 추이 확인
- **감정 패턴 파악**: 유사한 감정을 보이는 일기들의 통계 제공
- **과거 경험 참고**: 비슷한 상황에서 어떻게 대처했는지 확인

### 효과
- 페이지 전환 지연 최소화
- 불필요한 API 호출 최소화
- 사용자 경험 개선

---

---

# 📝 라이선스

This project is licensed under the MIT License

---

# 📚 참고 자료

이 프로젝트는 다음 외부 기술, 데이터셋, 라이브러리를 활용하여 구현되었습니다:

## 데이터셋
| 리소스 | 설명 |
|--------|------|
| AI Hub – 감성대화말뭉치 | ML 감정 분석 모델 학습용 한국어 감성 대화 데이터 |

## AI / 모델
| 리소스 | 설명 |
|--------|------|
| OpenAI GPT-4o-mini | 감정 분석, 대화 생성, 편지 생성 |

## 백엔드 라이브러리
| 리소스 | 설명 |
|--------|------|
| Flask 3.1.2 | REST API 서버 |
| flask-cors 6.0.1 | CORS 처리 |
| psycopg2-binary 2.9.9+ | PostgreSQL 연결 |
| gunicorn 21.2.0+ | 프로덕션 WSGI 서버 |
| python-dotenv 1.2.1 | 환경변수 관리 |
| openai 1.0.0+ | OpenAI API 클라이언트 |

## 머신러닝 / 딥러닝
| 리소스 | 설명 |
|--------|------|
| transformers 4.39.3+ | KLUE-RoBERTa 기반 감정 분류 딥러닝 모델 |
| sentence-transformers 2.2.0+ | Sentence Transformer 기반 유사 일기 검색 딥러닝 모델 |
| torch 2.0.0+ | Transformers 모델 실행 환경 |
| matplotlib 3.8.0+ | 데이터 시각화 (학습 스크립트용) |
| seaborn 0.13.0+ | 통계 데이터 시각화 (학습 스크립트용) |

## 프론트엔드
| 리소스 | 설명 |
|--------|------|
| React 19.2.0 | UI 구현 |
| Vite (rolldown-vite 7.2.2) | 빌드 도구 및 개발 서버 |
| Dongle Font (Google Fonts) | UI용 커스텀 폰트 |

## 데이터베이스
| 리소스 | 설명 |
|--------|------|
| PostgreSQL | 관계형 데이터베이스 관리 시스템 |

## 배포 플랫폼
| 리소스 | 설명 |
|--------|------|
| Vercel | 프론트엔드 배포 |
| Railway | 백엔드 및 PostgreSQL 호스팅 |

---

# 📌 프로젝트 한계 및 개선 방향

moodtown은 다양한 기능을 통합한 프로젝트이지만, 개발 과정에서 여러 기술적·환경적 한계가 존재했습니다.

## 1. GPT 기반 감정 분석의 일관성

LLM 특성상 같은 입력에도 미세하게 다른 감정 점수를 출력할 수 있어 일관성을 완전히 보장하기 어렵습니다.

**개선 방향**: temperature 고정, 프롬프트 강화, GPT 결과를 딥러닝 모델 예측과 결합

## 2. 시각적 표현의 한계

구현 시간과 리소스의 부족으로 풍부한 인터랙션과 애니메이션을 충분히 반영하지 못했습니다.

**개선 방향**: 감정 변화에 따른 동적 애니메이션 추가, WebGL/Canvas 기반 그래픽 요소 적용

## 3. 주민 성격 개인화 미구현

현재 버전에서는 기본 성격 기반의 고정형 대화만 제공됩니다.

**개선 방향**: 사용자 감정 통계 기반 adaptive character 모델 설계, 사용자 성향 프로필을 반영한 주민 톤 변화

## 4. 딥러닝 감정 분석 모델의 성능 한계

AI Hub 감성대화말뭉치를 기반으로 학습한 모델은 약 63%의 정확도를 보였습니다. 주요 원인:

- **데이터셋 라벨 구조의 모호성**: '당황'과 '상처' 라벨의 경계가 모호
- **도메인 차이**: 데이터셋은 구어체 발화, moodtown은 문어체 일기 텍스트
- **학습 환경 제약**: Google Colab의 GPU 사용 시간 제한으로 하이퍼파라미터 실험 제한

**개선 방향**: 자체 일기 기반 데이터셋 수집, 도메인 적응 기법 도입, 장시간 학습 및 하이퍼파라미터 실험 수행
