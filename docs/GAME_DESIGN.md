# 🎮 게임 디자인

MoodTown의 게임화 요소에 대한 상세 설명입니다.

## 행복 나무

### 기본 개념
긍정적인 감정이 쌓이면 자라나는 나무입니다. 나무가 성장하고 열매를 맺는 과정을 통해 긍정적인 감정 표현에 대한 성취감을 제공합니다.

### 작동 메커니즘

#### 감정 기여도
다음 감정들이 행복 나무의 성장에에 기여합니다:
- **기쁨**: 즐거움, 행복, 신남
- **사랑**: 애정, 우정, 따뜻함
- **놀람** (긍정적): 기쁜 소식, 반가운 소식 등
- **부끄러움** (긍정적): 설레는 감정, 좋아하는 사람에 대한 부끄러움 등

**주의**: 놀람과 부끄러움은 문맥에 따라 긍정/부정으로 구분됩니다. 자세한 내용은 [프로젝트 소개](INTRO.md#문맥-기반-감정-분류)를 참고하세요.

#### 성장 단계
나무는 여러 단계로 성장합니다:

**씨앗**(0점 이상)
-> **새싹**(40점 이상)
-> **묘목**(100점 이상)
-> **작은 나무**(220점 이상)
-> **큰 나무**(380점 이상) -> **행복 열매**(600점 이상)

행복 열매가 맺히면 나무의 상태는 초기화됩니다.

#### 열매 시스템
- 나무가 완전히 자라면 열매가 열립니다
- 열매가 열리면 "행복 열매" 개수가 증가합니다
- 열매가 열릴 때마다 축하 편지가 전송됩니다
- 열매가 열리면 스트레스 우물의 물이 일정량 줄어듭니다

### 수치 계산
- 긍정적 감정의 점수 합계에 비례하여 나무가 자라납니다
- 긍정적인 감정만 있는 날은 보너스 점수가 추가됩니다

## 스트레스 우물

### 기본 개념
부정적인 감정이 쌓이면 우물에 물이 차오르는 시스템입니다. 물이 넘치면 주민들이 위로하는 편지를 보냅니다. 스트레스를 시각적으로 확인할 수 있습니다.

### 작동 메커니즘

#### 감정 기여도
다음 감정들이 스트레스 우물에 물을 채웁니다:
- **분노**: 화남, 짜증, 불평불만
- **슬픔**: 우울함, 무기력함, 속상함
- **두려움**: 불안함, 걱정, 초조함
- **놀람** (부정적): 충격, 실망, 황당함 등
- **부끄러움** (부정적): 창피함, 수치심, 민망함 등

**주의**: 놀람과 부끄러움은 문맥에 따라 긍정/부정으로 구분됩니다.

#### 물 높이 계산
- 부정적 감정의 점수 합계에 비례하여 물이 차오릅니다
- 물 높이는 0~100%로 표시됩니다

#### 특별 규칙
- **긍정 감정만 있을 경우**: 물이 30점 줄어듭니다
  - 즉, 순수 긍정 일기를 작성하면 스트레스가 감소합니다

#### 넘침 처리
- 물이 100%에 도달하면 "넘침" 상태가 됩니다
- 넘치면 주민들이 위로하는 편지를 자동으로 전송합니다
- 물이 넘친 후 "우물 비우기" 버튼을 누르면 우물이 초기화됩니다.

### 수치 계산
- 부정적 감정의 점수 합계에 비례하여 물 높이가 증가합니다
- 긍정적 감정만 있을 경우 -30점 감소

## 편지 시스템

### 기본 개념
감정 주민들이 특정 상황에서 사용자에게 편지를 보내는 시스템입니다.

### 편지 종류

#### 1. 감정 편지
- **조건**: 특정 감정 점수가 70점 이상일 때
- **발신인**: 해당 감정의 주민
- **내용**: 감정에 대한 주민의 메시지

예시:
- 기쁨 80점 → 노랑이가 기쁨에 대한 편지 전송
- 분노 75점 → 빨강이가 분노에 대한 편지 전송

#### 2. 축하 편지
- **조건**: 행복 나무에 열매가 열릴 때
- **발신인**: 긍정적 감정 주민들 (기쁨, 사랑 등)
- **내용**: 열매가 열린 것을 축하하는 메시지


예시:
- "첫 번째 행복 열매가 열렸어! 축하해! 앞으로 같이 행복을 가꿔 보자."

#### 3. 위로 편지
- **조건**: 스트레스 우물의 물이 넘칠 때
- **발신인**: 부정적 감정 주민들 (슬픔, 분노, 두려움 등)
- **내용**: 위로와 격려의 메시지

### 편지 생성
- GPT-4o-mini가 편지 내용을 생성합니다
- 각 주민의 고유한 성격과 말투가 반영됩니다
- 편지는 감정 우체통통에 저장되며, 우체통에서 확인 및 삭제할 수 있습니다.


## 와글와글 광장

### 기본 개념
감정 주민들이 일기 내용에 대해 대화를 나누는 공간입니다.

### 대화 생성

#### 참여 주민
- **주요 감정** (score > 0): 자신의 감정을 주로 표현
- **반응 감정** (score = 0): 다른 감정들에게 반응만 (위로, 동조, 반박 등)

#### 대화 생성 과정
1. 감정 분석 결과 확인
2. 주요 감정과 반응 감정 결정정
3. GPT-4o-mini가 각 주민의 특성을 반영한 대화 생성
4. 대화를 데이터베이스에 저장

#### 대화 저장
- 대화는 JSONB 형식으로 데이터베이스에 저장됩니다
- 같은 날짜의 일기에는 동일한 대화가 재사용됩니다
- 일기를 수정하면 새로운 대화가 생성됩니다

### 채팅 기능
- 사용자가 주민들과 직접 채팅할 수 있습니다
- 채팅 내용은 GPT-4o-mini가 생성하며, 각 주민의 성격이 반영됩니다

## 게임 밸런스

### 점수 시스템
- 각 감정은 0~100점으로 표시됩니다
- 여러 감정이 동시에 존재할 수 있습니다
- 점수는 정규화되어 총합이 100이 됩니다

### 성장 속도
- 행복 나무와 스트레스 우물의 성장 속도는 감정 점수에 비례합니다
- 일기 작성 횟수가 많을수록 변화가 누적됩니다

### 동기 부여
- 연속 일기 작성 표시
  - 마을 사무소에서 연속으로 일기를 작성한 일수를 제공
- 행복 열매 수집
- 주민들과의 대화
- 편지 수신

## 관련 문서

- [주요 기능](FEATURES.md)
- [프로젝트 소개](INTRO.md)
- [API 레퍼런스](API_REFERENCE.md)

[← README로 돌아가기](../README.md)
